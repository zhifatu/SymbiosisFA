# 决策记录 003：分层架构与数据源规则

## 状态
✅ 已采纳（2026-02-13）

## 问题背景
早期实现中，五个场系统直接从第一层（八元素定义）跳至第三层（场逻辑），
跳过了第二层（8×8矩阵、间接影响、张力计算），导致：
- 硬编码阈值泛滥
- 数学核心被架空
- 测试不可靠

## 解决方案
建立严格的三层依赖架构：
第一层：数学核心 (core/math/)
└── 纯数值计算，无业务语义
↓
第二层：数据源 (core/data_source.py)
└── 唯一数据入口，封装所有数学核心
↓
第三层：场系统 (core/fields/)
└── 只调用 DataSource，不自己计算

text

## 核心规则
1. **所有数值阈值必须在 `DataSource.config` 中定义**
2. **所有数学公式必须在 `core/math/` 中实现**
3. **场系统不允许出现 `0.05`、`0.01` 等字面常量**
4. **跨场数据必须通过 CoordinationField，不允许直接调用**

## 收益
- 阈值集中管理，一处修改处处生效
- 数学核心可独立测试
- 新场开发者：不需要知道数学怎么算，只需要知道从哪里拿数据