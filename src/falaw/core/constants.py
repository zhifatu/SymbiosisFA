"""秩法图理论常数体系 —— 理论的核心数值锚点

此文件定义了秩法图的所有常数参数，包括：
- 自我保留率（对角线元素）
- 临界点 R=0.5
- 间接影响衰减因子
- 可能性空间维度
- 元素属性向量
- 张力场阈值
- 效应函数参数

冻结日期：2026-02-11
状态：正式发布版本，后续变更需经理论组评审

任何思想都需要一个锚点。这是秩法图的锚。
"""

from typing import Dict, List
from dataclasses import dataclass

from falaw.models.enums import Element


@dataclass
class FALawConstants:
    """秩法图常数体系 —— 理论的核心数值锚点"""

    # ====================================================
    # 1. 基础守恒律
    # ====================================================

    TOTAL_PRIMAL_FORCE: float = 1.0
    """总原力守恒值（归一化基准）"""

    ELEMENT_COUNT: int = 8
    """元素数量（不可变）"""

    # ====================================================
    # 2. 自我保留率（对角线）—— 元素的本体性
    # ====================================================
    # 意义：每个元素至少保留50%自身原力，确保系统不会完全消解
    # 范围：[0.5, 1.0]

    SELF_RETENTION: Dict[Element, float] = {
        Element.QIAN: 0.70,   # 乾定：高度稳定
        Element.SHE: 0.65,    # 射：适度稳定
        Element.XIAN: 0.75,   # 陷：高度保留（粘滞性）
        Element.LI: 0.60,     # 离：较低保留（易变）
        Element.JIE: 0.68,    # 界：适度稳定
        Element.SAN: 0.55,    # 散：较低保留（易扩散）
        Element.HUAN: 0.62,   # 换：适度保留
        Element.KUN: 0.58,    # 坤转：较低保留（易变）
    }

    # ====================================================
    # 3. 临界点常数 —— 量变到质变的分界线
    # ====================================================
    # 这是秩法图最重要的数值发现。
    # 当 R < 0.5：线性响应，量变阶段
    # 当 R = 0.5：临界点
    # 当 R > 0.5：非线性响应，质变阶段

    CRITICAL_R: float = 0.5
    """量变质变临界点（贯穿所有效应函数）"""

    # ====================================================
    # 4. 间接影响衰减因子 —— 社会网络的“距离律”
    # ====================================================
    # 物理类比：万有引力随距离平方衰减
    # 秩法类比：间接影响每阶衰减30%

    INDIRECT_DECAY: float = 0.7
    """每阶间接影响衰减因子（0.7^(n-1)）"""

    # ====================================================
    # 5. 可能性空间维度 —— 系统演化的正交基底
    # ====================================================

    POSSIBILITY_DIMENSIONS: List[str] = [
        'stability',     # 稳定性
        'flexibility',   # 灵活性
        'diversity',     # 多样性
        'connectivity',  # 连接性
        'novelty',       # 新颖性
        'efficiency'     # 效率
    ]

    # ====================================================
    # 6. 元素属性空间 —— 每个元素在6维空间中的坐标
    # ====================================================
    # 这是秩法图的“元素周期表”

    ELEMENT_PROPERTIES: Dict[Element, List[float]] = {
        Element.QIAN: [0.8, 0.2, 0.1, 0.3, 0.1, 0.6],   # 乾定：秩序
        Element.SHE:  [0.3, 0.7, 0.6, 0.4, 0.8, 0.4],   # 射：观察
        Element.XIAN: [0.6, 0.1, 0.2, 0.5, 0.3, 0.3],   # 陷：沉浸
        Element.LI:   [0.1, 0.9, 0.7, 0.2, 0.6, 0.2],   # 离：退出
        Element.JIE:  [0.7, 0.4, 0.3, 0.6, 0.2, 0.5],   # 界：边界
        Element.SAN:  [0.2, 0.8, 0.9, 0.7, 0.5, 0.3],   # 散：扩散
        Element.HUAN: [0.4, 0.6, 0.8, 0.9, 0.4, 0.7],   # 换：交换
        Element.KUN:  [0.1, 0.9, 0.5, 0.3, 0.9, 0.2],   # 坤转：革命
    }

    # ====================================================
    # 7. 效应函数参数
    # ====================================================

    EFFECT_PARAMS: Dict[str, float] = {
        'linear_coefficient': 0.8,      # 线性效应系数
        'nonlinear_exponent': 2.0,      # 非线性指数
        'saturation_limit': 1.2,        # 饱和上限
        'minimum_effect': 0.05,         # 最小效应
        'maximum_effect': 3.0,          # 最大效应
    }

    # ====================================================
    # 8. 张力场阈值
    # ====================================================

    TENSION_THRESHOLDS: Dict[str, float] = {
        'low': 0.2,
        'medium': 0.5,
        'high': 0.7,
        'critical': 0.9
    }


# 单例实例（便于导入）
constants = FALawConstants()